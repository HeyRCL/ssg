{% extends "/html/base-large.html" %}
{%block subtitle %}: {{page.title}}{% endblock %}
{% block content %}

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

<div>
	<div id="page-header">
		<h2>{{page.title}}</h2>
	</div>

	<div id="puzzle-intro">
		<p>{{ page.introText }}</p>
	</div>

<!--  HEY! need to either use "../../img/{{ card }}.jpg" in dev or {{site-url}}/img/{{ card }}.jpg" in prod -->

	<!-- pre-loading all our images. This must remain or the canvas drawing breaks. -->
	<div id="imagesDiv" style="display:none">
		{% if page.ourCards|not-empty %}
			{% for card in page.ourCards %}
				<img id="{{card}}" width="97" height="135" 
				src="../../img/{{ card }}.jpg" alt="{{ card }}">
			{% endfor %}
		{% endif %}
		{% if page.oppCards|not-empty %}
			{% for card in page.oppCards %}
				<img id="{{card}}" width="97" height="135" 
				src="../../img/{{ card }}.jpg" alt="{{ card }}">
			{% endfor %}
		{% endif %}
	</div>

	<canvas id="myCanvas" width="900" height="600"
	style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag... RIP
	</canvas>


	<script>
		window.onload = function() {

		// maintenance on the page
		$("#solution").hide();

		// Moving on to setting up the puzzle canvas

		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");

		var card_width = 97;
		var card_height = 135;

		var screen_y = 600;
		var screen_x = 900;

		var edge_buffer = 10;
		var hand_separation_width = card_width / 2; 

		// Separated by 1/2 height of card (55) - not doing this any more
		/*
		ctx.drawImage(img, 10, 10, card_width, card_height);
		ctx.drawImage(img, 65, 10, card_width, card_height);
		ctx.drawImage(img, 120, 10, card_width, card_height);
		ctx.drawImage(img, 175, 10, card_width, card_height);
		ctx.drawImage(img, 230, 10, card_width, card_height);
		ctx.drawImage(img, 285, 10, card_width, card_height);
		ctx.drawImage(img, 340, 10, card_width, card_height);
		ctx.drawImage(img, 395, 10, card_width, card_height);
		ctx.drawImage(img, 450, 10, card_width, card_height);
		*/
		
		// Separated by 1/3 height of card (37)
		/*
		ctx.drawImage(img, 10, 165, card_width, card_height);
		ctx.drawImage(img, 47, 165, card_width, card_height);
		ctx.drawImage(img, 84, 165, card_width, card_height);
		ctx.drawImage(img, 121, 165, card_width, card_height);
		ctx.drawImage(img, 158, 165, card_width, card_height);
		ctx.drawImage(img, 195, 165, card_width, card_height);
		ctx.drawImage(img, 232, 165, card_width, card_height);
		ctx.drawImage(img, 269, 165, card_width, card_height);
		ctx.drawImage(img, 306, 165, card_width, card_height); */

	// Draw our hand //

	{% if page.ourCards|not-empty %}
		num_cards = {{page.ourCards|count}}; // cache it
		// we start at the center of the screen, but our x,y that we draw at is the upper left
		// corner of the card. So when we draw in the center it isn't screen_x/2 it's screen_x/2 - (card_width /2)
		cur_x = ((screen_x / 2) - (card_width / 2)) - ((hand_separation_width / 2) * (num_cards - 1));
		hand_y = screen_y - edge_buffer - card_height;
		{% for card in page.ourCards %}
			var img = document.getElementById("{{ card }}");
			ctx.drawImage(img, cur_x, hand_y, card_width, card_height);
			cur_x += hand_separation_width;
		{% endfor %}
	{% endif %}
	
	{% if page.oppCards|not-empty %}
		num_cards = {{page.oppCards|count}}; // cache it
		// we start at the center of the screen, but our x,y that we draw at is the upper left
		// corner of the card. So when we draw in the center it isn't screen_x/2 it's screen_x/2 - (card_width /2)
		cur_x = ((screen_x / 2) - (card_width / 2)) - ((hand_separation_width / 2) * (num_cards - 1));
		hand_y = 0 + edge_buffer; // screen_y - edge_buffer - card_height;
		{% for card in page.oppCards %}
			var img = document.getElementById("{{ card }}");
			ctx.drawImage(img, cur_x, hand_y, card_width, card_height);
			cur_x += hand_separation_width;
		{% endfor %}
	{% endif %}

	
	/* this is all working correctly, refactored in to code above */
	/*
		num_cards = 9;
		hand_y = screen_y - edge_buffer - card_height;

		card_separation_width = card_width / 2; 
	
		// we start at the center of the screen, but our x,y that we draw at is the upper left
		// corner of the card. So when we draw in the center it isn't screen_x/2 it's screen_x/2 - (card_width /2)
		var cur_x = ((screen_x / 2) - (card_width / 2)) - ((card_separation_width / 2) * (num_cards - 1));
		var i;
		for (i = 0; i < num_cards; i++) {
			ctx.drawImage(img, cur_x, hand_y, card_width, card_height);
//			ctx.drawImage(img, cur_x, hand_y - edge_buffer - card_height, card_width, card_height);
			cur_x += card_separation_width;
		}
	*/	
		

		// draw center line of page
		ctx.beginPath();
		ctx.moveTo(20, screen_y / 2);
		ctx.lineTo(screen_x - 20, screen_y / 2);
		ctx.lineWidth = 1;
		ctx.strokeStyle = 'black';
		ctx.stroke();
		};
	</script>

	<div id="storm-count">
	{% if page.stormCount %}
	Storm count: <b>{{page.stormCount}}</b>
	{% else %}
	Storm count: <b>0</b>
	{% endif %}
	</div>

	<div id="opp-life">
	{% if page.oppLife %}
	Opponent Life: <b>{{ page.oppLife }}</b>
	{% else %}
	Opponent Life: <b>20</b>
	{% endif %}
	</div>
	
	<div id="our-life">
	{% if page.ourLife %}
	Our Life: <b>{{ page.ourLife }}</b>
	{% else %}
	Our Life: <b>20</b>
	{% endif %}
	</div>

<div class="widget">
  <button id="show-solution-button">Show Solution</button>
</div>

	<div id="solution"> 
		<h3>Solution</h3>
		Blah blah blah<br>
		Blah blah blah<br>
		Blah blah blah<br>
		Blah blah blah<br>
		Blah blah blah<br>
		Blah blah blah<br>
		Blah blah blah<br>
	</div>

<script>
 //style="visibility: hidden">
console.log($('#show-solution-button').text());
$( "#show-solution-button").click(function() {
	if($('#show-solution-button').text() == "Show Solution") {
		$("#solution").show();
		$('#show-solution-button').text("Hide Solution");
	} else {
		$("#solution").hide();
		$('#show-solution-button').text("Show Solution");
	}
});
</script>

	{% if page.oppCards|not-empty %}
	Showing Opponent's Hand<br>
	<div class="container">
		<div class="row">
			<div id="opponent-hand" class="span6">
			{% for card in page.oppCards %}
				<img src="../../img/{{ card }}.jpg">
			{% endfor %}
			</div>
		</div>
	</div>
	{% endif %}

	{% if page.oppBattlefieldLands|not-empty %}
	Showing Opponent's Battlefield (lands)<br>
	<div class="container">
		<div class="row">
			<div id="opponent-battlefield-lands" class="span6">
			{% for card in page.oppBattlefieldLands %}
				<img src="../../img/{{ card }}.jpg">
			{% endfor %}
			</div>
		</div>
	</div>
	{% endif %}
	{% if page.oppBattlefieldOther|not-empty %}
	Showing Opponent's Battlefield (other, such as creatures or artifacts)<br>
	<div class="container">
		<div class="row">
			<div id="opponent-battlefield-other" class="span6">
			{% for card in page.oppBattlefieldOther %}
				<img src="../../img/{{ card }}.jpg">
			{% endfor %}
			</div>
		</div>
	</div>
	{% endif %}


	{% if page.ourCards|not-empty %}
	Showing Our Hand<br>
	<div class="container">
		<div id="our-hand" class="col-md-12" style="padding-left: 0px;  padding-right: 0px;">
		{% for card in page.ourCards %}
			<img src="../../img/{{ card }}.jpg" class="img-fluid">
		{% endfor %}
		</div>
	</div>
	{% endif %}

	<br>
	Done showing hands here.<br>
	<br>

</div>

{% endblock %}
